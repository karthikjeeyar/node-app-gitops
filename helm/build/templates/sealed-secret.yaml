{{/*
  Sealed Secrets for secure credential management
  
  These secrets use cluster-wide scope, meaning:
  - They can be deployed to any namespace
  - No need to know the target namespace when sealing
  
  To enable:
  1. Generate sealed secrets using: kubeseal --scope cluster-wide
  2. Update Values.yaml with encrypted data
  3. Set enabled: true for each secret
  4. Commit and push - ArgoCD will sync
*/}}

# ===========================================
# Registry Credentials (Docker Config JSON)
# ===========================================
{{- if .Values.sealedSecrets.registry.enabled }}
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: {{ .Values.sealedSecrets.registry.secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    backstage.io/kubernetes-id: {{ .Values.app.name }}
    app.kubernetes.io/name: {{ .Values.app.name }}
  annotations:
    sealedsecrets.bitnami.com/cluster-wide: "true"
spec:
  encryptedData:
    .dockerconfigjson: {{ .Values.sealedSecrets.registry.encryptedData | quote }}
  template:
    metadata:
      name: {{ .Values.sealedSecrets.registry.secretName }}
      namespace: {{ .Release.Namespace }}
      labels:
        backstage.io/kubernetes-id: {{ .Values.app.name }}
    type: kubernetes.io/dockerconfigjson
{{- end }}
{{- if .Values.sealedSecrets.git.enabled }}
---
# ===========================================
# Git Credentials (Username + Token)
# ===========================================
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: {{ .Values.sealedSecrets.git.secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    backstage.io/kubernetes-id: {{ .Values.app.name }}
    app.kubernetes.io/name: {{ .Values.app.name }}
  annotations:
    sealedsecrets.bitnami.com/cluster-wide: "true"
spec:
  encryptedData:
{{ .Values.sealedSecrets.git.encryptedData | indent 4 }}
  template:
    metadata:
      name: {{ .Values.sealedSecrets.git.secretName }}
      namespace: {{ .Release.Namespace }}
      labels:
        backstage.io/kubernetes-id: {{ .Values.app.name }}
    type: Opaque
{{- end }}
{{- if .Values.sealedSecrets.argocd.enabled }}
---
# ===========================================
# ArgoCD Credentials (Username + Password)
# ===========================================
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: {{ .Values.sealedSecrets.argocd.secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    backstage.io/kubernetes-id: {{ .Values.app.name }}
    app.kubernetes.io/name: {{ .Values.app.name }}
  annotations:
    sealedsecrets.bitnami.com/cluster-wide: "true"
spec:
  encryptedData:
{{ .Values.sealedSecrets.argocd.encryptedData | indent 4 }}
  template:
    metadata:
      name: {{ .Values.sealedSecrets.argocd.secretName }}
      namespace: {{ .Release.Namespace }}
      labels:
        backstage.io/kubernetes-id: {{ .Values.app.name }}
    type: Opaque
{{- end }}

